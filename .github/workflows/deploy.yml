# Simple FTP Deployment for WebSupport.sk
# File location: .github/workflows/deploy.yml

name: üöÄ Deploy to WebSupport

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    name: üì§ FTP Deploy
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout Code
        uses: actions/checkout@v4
      
      - name: üìã Show Files
        run: |
          echo "üóÇÔ∏è Deploying these files:"
          find . -name "*.html" -o -name "*.css" -o -name "*.js" | head -10
          echo "Total files: $(find . -name "*.html" -o -name "*.css" -o -name "*.js" | wc -l)"
      
      # Method 1: Try basic FTP without encryption
      - name: üöÄ Deploy via Basic FTP
        id: basic_ftp
        continue-on-error: true
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          port: 21
          protocol: ftp
          
          local-dir: './'
          server-dir: '/palacebar.sk/web/'
          
          # Basic settings
          timeout: 30000
          log-level: verbose
          security: loose
          
          exclude: |
            **/.git*
            **/.github/**
            **/.DS_Store
            **/*.md
            **/README*
            **/.env*
            **/*.log
      
      # Method 2: Alternative FTP action if first fails
      - name: üîÑ Alternative FTP Deploy
        if: steps.basic_ftp.outcome == 'failure'
        uses: sebastianpopp/ftp-action@releases/v2
        with:
          host: ${{ secrets.FTP_HOST }}
          user: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          remoteDir: '/palacebar.sk/web'
          localDir: './'
      
      - name: ‚úÖ Success Message
        run: |
          echo "üéâ Deployment completed!"
          echo ""
          echo "üåê Your website should be live at:"
          echo "   ‚Ä¢ https://palacebar.sk/"
          echo "   ‚Ä¢ https://d.r6.wbsprt.com/palacebar.sk (backup URL)"
          echo ""
          echo "üìã Deployed files:"
          echo "   ‚Ä¢ HTML pages: $(find . -name "*.html" | wc -l)"
          echo "   ‚Ä¢ CSS files: $(find . -name "*.css" | wc -l)"
          echo "   ‚Ä¢ JS files: $(find . -name "*.js" | wc -l)"
          echo ""
          echo "üîß If issues persist, try WebFTP:"
          echo "   ‚Ä¢ https://webftp.palacebar.sk"
          echo "   ‚Ä¢ https://webftp.r6.websupport.sk"

  # Troubleshooting job
  debug:
    name: üîç Debug Info
    runs-on: ubuntu-latest
    needs: deploy
    if: failure()
    
    steps:
      - name: ‚ùå Troubleshooting Guide
        run: |
          echo "üîß TROUBLESHOOTING WEBSUPPORT.SK FTP CONNECTION"
          echo "================================================"
          echo ""
          echo "1. ‚úÖ CHECK YOUR GITHUB SECRETS:"
          echo "   Go to: Repository ‚Üí Settings ‚Üí Secrets ‚Üí Actions"
          echo "   Required secrets:"
          echo "   ‚Ä¢ FTP_HOST: palacebar.sk"  
          echo "   ‚Ä¢ FTP_USERNAME: [your_ftp_username]"
          echo "   ‚Ä¢ FTP_PASSWORD: [your_ftp_password]"
          echo "   ‚Ä¢ FTP_PORT: 21"
          echo ""
          echo "2. ‚úÖ VERIFY FTP CREDENTIALS:"
          echo "   Test at: https://webftp.palacebar.sk"
          echo "   Alternative: https://webftp.r6.websupport.sk"
          echo ""
          echo "3. ‚úÖ WEBSUPPORT.SK REQUIREMENTS:"
          echo "   ‚Ä¢ Protocol: FTP (unencrypted) - Port 21"
          echo "   ‚Ä¢ Directory: /palacebar.sk/web/"
          echo "   ‚Ä¢ May not support FTPS/SFTP on basic plans"
          echo ""
          echo "4. ‚úÖ COMMON FIXES:"
          echo "   ‚Ä¢ Ensure FTP account is created in WebSupport admin"
          echo "   ‚Ä¢ Check if domain is properly pointed to WebSupport"
          echo "   ‚Ä¢ Try connecting manually first via WebFTP"
          echo ""
          echo "5. üìß CONTACT WEBSUPPORT.SK:"
          echo "   If issues persist, contact WebSupport.sk support"
          echo "   They can verify FTP settings and server status"
