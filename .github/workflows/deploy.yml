# Static Frontend Deployment to WebSupport FTP
# File location: .github/workflows/deploy.yml

name: 🚀 Deploy Static Frontend

# Deploy on push to main branch
on:
  push:
    branches: [ main ]
  workflow_dispatch: # Manual trigger option

jobs:
  deploy:
    name: 📤 Deploy to WebSupport
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Get the code
      - name: 📥 Checkout Code
        uses: actions/checkout@v4
      
      # Step 2: Show what we're deploying
      - name: 📋 List Files to Deploy
        run: |
          echo "🗂️ Files ready for deployment:"
          find . -type f \( -name "*.html" -o -name "*.css" -o -name "*.js" -o -name "*.jpg" -o -name "*.png" -o -name "*.gif" -o -name "*.svg" \) | head -20
          echo ""
          echo "📊 File count by type:"
          echo "HTML files: $(find . -name "*.html" | wc -l)"
          echo "CSS files: $(find . -name "*.css" | wc -l)" 
          echo "JS files: $(find . -name "*.js" | wc -l)"
      
      # Step 3: Security check
      - name: 🔒 Security Check
        run: |
          echo "🔍 Checking for sensitive files..."
          if find . -name "*.env*" -o -name "*.key" -o -name "config.json" | grep -q .; then
            echo "⚠️ Warning: Sensitive files detected!"
            find . -name "*.env*" -o -name "*.key" -o -name "config.json"
          else
            echo "✅ No sensitive files found"
          fi
      
      # Step 4: Deploy via FTP
      - name: 🚀 Deploy to WebSupport FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          # Connection settings
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          port: ${{ secrets.FTP_PORT }}
          
          # Directory settings
          local-dir: './'
          server-dir: '/palacebar.sk/web/'
          
          # What NOT to upload
          exclude: |
            **/.git*
            **/.git*/**
            **/.github/**
            **/node_modules/**
            **/.DS_Store
            **/*.md
            **/README*
            **/LICENSE
            **/.gitignore
            **/.env*
            **/*.log
            **/.vscode/**
            **/.idea/**
            **/Thumbs.db
          
          # Deployment settings
          log-level: verbose
          security: strict
          dry-run: false
      
      # Step 5: Success message
      - name: ✅ Deployment Complete
        run: |
          echo "🎉 SUCCESS! Your website is now live!"
          echo ""
          echo "📍 Deployed to: https://palacebar.sk/"
          echo "🕒 Time: $(date)"
          echo "📝 Commit: ${{ github.sha }}"
          echo ""
          echo "🌐 Your files are now accessible at:"
          echo "   • Main page: https://palacebar.sk/"
          echo "   • Admin login: https://palacebar.sk/admin-login.html"
          echo "   • Menu: https://palacebar.sk/menu.html"
      
      # Step 6: Handle failures
      - name: ❌ Deployment Failed
        if: failure()
        run: |
          echo "💥 Deployment failed!"
          echo ""
          echo "🔧 Common solutions:"
          echo "   1. Check FTP credentials in repository secrets"
          echo "   2. Verify server connectivity" 
          echo "   3. Check file permissions"
          echo ""
          echo "🔍 Debug info:"
          echo "   Repository: ${{ github.repository }}"
          echo "   Branch: ${{ github.ref }}"
          echo "   Commit: ${{ github.sha }}"
