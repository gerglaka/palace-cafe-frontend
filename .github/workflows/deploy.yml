name: Git-FTP Deploy 

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    name: Git-FTP Deployment
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Get full history for git-ftp

      - name: Install Git-FTP
        run: |
          sudo apt-get update
          sudo apt-get install -y git-ftp curl

      - name: Configure Git-FTP
        run: |
          # Configure git-ftp with WebSupport.sk settings
          git config git-ftp.url ftp://${{ secrets.FTP_HOST }}/palacebar.sk/web
          git config git-ftp.user ${{ secrets.FTP_USERNAME }}
          git config git-ftp.password ${{ secrets.FTP_PASSWORD }}
          
          # Set FTP options for WebSupport.sk compatibility  
          git config git-ftp.syncroot ./
          git config git-ftp.insecure true  # For basic FTP

      - name: Initialize Git-FTP (First time only)
        continue-on-error: true
        run: |
          echo "ðŸ”„ Trying to initialize git-ftp..."
          git ftp init || echo "Already initialized or push instead"

      - name: Deploy Changes with Git-FTP
        run: |
          echo "ðŸš€ Deploying changes..."
          git ftp push
          echo "âœ… Deployment completed!"

      - name: Verify Deployment
        run: |
          echo "ðŸŽ‰ Website should be live at: https://palacebar.sk/"
          echo "ðŸ“‹ Deployment details:"
          echo "  â€¢ Method: Git-FTP (Free)"
          echo "  â€¢ Target: /palacebar.sk/web"
          echo "  â€¢ Time: $(date)"
          echo "  â€¢ Commit: ${{ github.sha }}"
