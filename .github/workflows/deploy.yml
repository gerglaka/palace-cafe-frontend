# Simple cURL FTP Deployment (Should work with WebSupport.sk)
# File: .github/workflows/simple-deploy.yml

name: Simple FTP Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    name: Upload Files via cURL FTP
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Test FTP Connection First
        run: |
          echo "🔍 Testing FTP connection..."
          curl -v --ftp-pasv \
            -u "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
            "ftp://${{ secrets.FTP_HOST }}/palacebar.sk/web/" \
            --max-time 30 \
            2>&1 | head -20

      - name: Upload HTML Files
        run: |
          echo "📄 Uploading HTML files..."
          for file in *.html; do
            if [ -f "$file" ]; then
              echo "Uploading: $file"
              curl --ftp-create-dirs --ftp-pasv \
                -T "$file" \
                -u "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
                "ftp://${{ secrets.FTP_HOST }}/palacebar.sk/web/$file" \
                --max-time 60
            fi
          done

      - name: Upload CSS Files  
        run: |
          echo "🎨 Uploading CSS files..."
          for file in *.css; do
            if [ -f "$file" ]; then
              echo "Uploading: $file"
              curl --ftp-create-dirs --ftp-pasv \
                -T "$file" \
                -u "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
                "ftp://${{ secrets.FTP_HOST }}/palacebar.sk/web/$file" \
                --max-time 60
            fi
          done

      - name: Upload JavaScript Files
        run: |
          echo "⚡ Uploading JavaScript files..."
          for file in *.js; do
            if [ -f "$file" ]; then
              echo "Uploading: $file"
              curl --ftp-create-dirs --ftp-pasv \
                -T "$file" \
                -u "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
                "ftp://${{ secrets.FTP_HOST }}/palacebar.sk/web/$file" \
                --max-time 60
            fi
          done

      - name: Upload Other Files (Images, etc.)
        run: |
          echo "📁 Uploading other files..."
          for file in *.png *.jpg *.jpeg *.gif *.svg *.ico *.pdf *.txt; do
            if [ -f "$file" ]; then
              echo "Uploading: $file"
              curl --ftp-create-dirs --ftp-pasv \
                -T "$file" \
                -u "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
                "ftp://${{ secrets.FTP_HOST }}/palacebar.sk/web/$file" \
                --max-time 60
            fi
          done

      - name: Success Message
        run: |
          echo "🎉 Deployment completed successfully!"
          echo "🌐 Your website is live at: https://palacebar.sk/"
          echo "📅 Deployment time: $(date)"
          echo "📝 Files uploaded from commit: ${{ github.sha }}"
          
          echo ""
          echo "📋 Uploaded files:"
          echo "  • HTML: $(ls *.html 2>/dev/null | wc -l) files"
          echo "  • CSS: $(ls *.css 2>/dev/null | wc -l) files" 
          echo "  • JS: $(ls *.js 2>/dev/null | wc -l) files"
